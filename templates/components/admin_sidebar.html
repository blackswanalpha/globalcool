{% load static %}

<!-- Enhanced Admin Sidebar -->
<div class="sidebar" id="adminSidebar">
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle d-none d-lg-block" id="sidebarToggle" title="Toggle Sidebar">
        <i class="fas fa-chevron-left"></i>
    </button>

    <!-- Brand Area -->
    <div class="sidebar-brand">
        <a href="{% url 'users:admin_dashboard' %}" class="brand-logo">
            <i class="fas fa-snowflake"></i>
            <span class="brand-text">Global Cool-Light</span>
        </a>
    </div>

    <!-- User Profile Section -->
    <div class="sidebar-user">
        <img src="{% static 'admin-img/user.jpg' %}" alt="User Avatar" class="user-avatar">
        <div class="user-info">
            <h6>{{ user.get_full_name|default:user.email|truncatechars:15 }}</h6>
            <span>Administrator</span>
        </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="navbar navbar-light">
        <div class="navbar-nav w-100">
            
            <!-- Overview Section -->
            <div class="nav-group">
                <div class="nav-group-title">Overview</div>
                <a href="{% url 'users:admin_dashboard' %}" class="nav-item nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item nav-link">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                </a>
            </div>

            <!-- Operations Section -->
            <div class="nav-group">
                <div class="nav-group-title">Operations</div>
                
                <!-- Bookings Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-calendar-check"></i>
                        <span>Bookings</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_bookings_list' %}" class="dropdown-item">
                            <i class="fas fa-list"></i>All Bookings
                        </a>
                        <a href="{% url 'users:admin_bookings_list' %}?status=new" class="dropdown-item">
                            <i class="fas fa-clock"></i>Pending Bookings
                        </a>
                        <a href="{% url 'users:admin_bookings_list' %}?status=completed" class="dropdown-item">
                            <i class="fas fa-check-circle"></i>Completed Bookings
                        </a>
                    </div>
                </div>

                <!-- Services & Products Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-tools"></i>
                        <span>Services & Products</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_services_products' %}" class="dropdown-item">
                            <i class="fas fa-cog"></i>Manage All
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-plus-circle"></i>Add Service
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-box"></i>Add Product
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-tags"></i>Categories
                        </a>
                    </div>
                </div>

                <!-- Quotations Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle {% if 'quotation' in request.resolver_match.url_name %}active{% endif %}" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Quotations</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_quotations_list' %}" class="dropdown-item">
                            <i class="fas fa-list"></i>All Quotations
                        </a>
                        <a href="{% url 'users:admin_quotation_create' %}" class="dropdown-item">
                            <i class="fas fa-plus-circle"></i>Create Quotation
                        </a>
                        <a href="{% url 'users:admin_quotations_list' %}?status=draft" class="dropdown-item">
                            <i class="fas fa-edit"></i>Draft Quotations
                        </a>
                        <a href="{% url 'users:admin_quotations_list' %}?status=sent" class="dropdown-item">
                            <i class="fas fa-paper-plane"></i>Sent Quotations
                        </a>
                        <a href="{% url 'users:admin_quotations_list' %}?status=accepted" class="dropdown-item">
                            <i class="fas fa-check-circle"></i>Accepted Quotations
                        </a>
                        <a href="{% url 'users:admin_quotations_list' %}?status=pending" class="dropdown-item">
                            <i class="fas fa-clock"></i>Pending Response
                        </a>
                    </div>
                </div>

                <!-- Portfolio Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle {% if 'portfolio' in request.resolver_match.url_name %}active{% endif %}" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-briefcase"></i>
                        <span>Portfolio</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_portfolio_list' %}" class="dropdown-item">
                            <i class="fas fa-list"></i>All Projects
                        </a>
                        <a href="{% url 'users:admin_portfolio_add' %}" class="dropdown-item">
                            <i class="fas fa-plus-circle"></i>Add Project
                        </a>
                        <a href="{% url 'users:admin_portfolio_list' %}?is_published=true" class="dropdown-item">
                            <i class="fas fa-eye"></i>Published Projects
                        </a>
                        <a href="{% url 'users:admin_portfolio_list' %}?is_published=false" class="dropdown-item">
                            <i class="fas fa-eye-slash"></i>Draft Projects
                        </a>
                        <a href="{% url 'users:admin_portfolio_list' %}?featured_only=true" class="dropdown-item">
                            <i class="fas fa-star"></i>Featured Projects
                        </a>
                        <a href="{% url 'users:admin_testimonial_add' %}" class="dropdown-item">
                            <i class="fas fa-quote-left"></i>Add Testimonial
                        </a>
                    </div>
                </div>
            </div>

            <!-- Business Section -->
            <div class="nav-group">
                <div class="nav-group-title">Business</div>
                <a href="#" class="nav-item nav-link">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Quotations</span>
                </a>

                <!-- Leads Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-comments"></i>
                        <span>Leads</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_leads_list' %}" class="dropdown-item">
                            <i class="fas fa-list"></i>All Leads
                        </a>
                        <a href="{% url 'users:admin_leads_list' %}?status=active" class="dropdown-item">
                            <i class="fas fa-comment-dots"></i>Active Chats
                        </a>
                        <a href="{% url 'users:admin_leads_list' %}?status=new" class="dropdown-item">
                            <i class="fas fa-bell"></i>New Leads
                        </a>
                        <a href="{% url 'users:admin_leads_list' %}?unread=true" class="dropdown-item">
                            <i class="fas fa-envelope"></i>Unread Messages
                        </a>
                    </div>
                </div>

                <!-- Customers Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-users"></i>
                        <span>Customers</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_customers_list' %}" class="dropdown-item">
                            <i class="fas fa-list"></i>All Customers
                        </a>
                        <a href="{% url 'users:admin_customer_add' %}" class="dropdown-item">
                            <i class="fas fa-plus-circle"></i>Add Customer
                        </a>
                        <a href="{% url 'users:admin_customers_list' %}?client_type=individual" class="dropdown-item">
                            <i class="fas fa-user"></i>Individual Clients
                        </a>
                        <a href="{% url 'users:admin_customers_list' %}?client_type=business" class="dropdown-item">
                            <i class="fas fa-building"></i>Business Clients
                        </a>
                    </div>
                </div>
                
                <!-- Reports Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-dollar-sign"></i>Revenue Reports
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-chart-pie"></i>Booking Analytics
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-user-chart"></i>Customer Reports
                        </a>
                    </div>
                </div>
            </div>

            <!-- System Section -->
            <div class="nav-group">
                <div class="nav-group-title">System</div>
                <a href="#" class="nav-item nav-link">
                    <i class="fas fa-edit"></i>
                    <span>CMS</span>
                </a>
                
                <!-- Settings Dropdown -->
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                    <div class="dropdown-menu bg-transparent border-0">
                        <a href="{% url 'users:admin_settings_general' %}" class="dropdown-item">
                            <i class="fas fa-sliders-h"></i>General Settings
                        </a>
                        <a href="{% url 'users:admin_user_management' %}" class="dropdown-item">
                            <i class="fas fa-users-cog"></i>User Management
                        </a>
                        <a href="{% url 'users:admin_email_templates' %}" class="dropdown-item">
                            <i class="fas fa-envelope"></i>Email Templates
                        </a>
                        <a href="{% url 'users:admin_security_settings' %}" class="dropdown-item">
                            <i class="fas fa-shield-alt"></i>Security
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer mt-auto p-3 d-none d-lg-block">
        <div class="text-center">
            <small class="text-muted">
                © {{ current_year|default:"2024" }} Global Cool-Light<br>
                Version 1.0
            </small>
        </div>
    </div>
</div>

<!-- Sidebar Overlay for Mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('adminSidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const content = document.querySelector('.content');
    
    // Desktop sidebar toggle
    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            if (content) {
                content.classList.toggle('expanded');
            }
            
            // Save state to localStorage
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        });
    }
    
    // Mobile sidebar toggle
    const mobileToggle = document.querySelector('.sidebar-toggler');
    if (mobileToggle) {
        mobileToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
        });
    }
    
    // Close sidebar when clicking overlay
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            document.body.style.overflow = '';
        });
    }
    
    // Restore sidebar state from localStorage
    const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (sidebarCollapsed && window.innerWidth >= 992) {
        sidebar.classList.add('collapsed');
        if (content) {
            content.classList.add('expanded');
        }
    }
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth >= 992) {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
    
    // Close mobile dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (window.innerWidth < 992) {
            const dropdowns = sidebar.querySelectorAll('.dropdown-menu.show');
            dropdowns.forEach(dropdown => {
                if (!dropdown.closest('.dropdown').contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });
        }
    });
});
</script>
