{% extends 'admin/admin_base.html' %}
{% load static %}

{% block title %}Delete Project: {{ project.title }} - Global Cool-Light E.A LTD{% endblock %}

{% block content %}
<!-- Include Enhanced Sidebar -->
{% include 'components/admin_sidebar.html' %}

<!-- Content Start -->
<div class="content">
    <!-- Navbar Start -->
    <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
        <a href="#" class="sidebar-toggler flex-shrink-0">
            <i class="fa fa-bars"></i>
        </a>
        <div class="navbar-nav align-items-center ms-auto">
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa fa-user me-lg-2"></i>
                    <span class="d-none d-lg-inline-flex">{{ user.get_full_name|default:user.username }}</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                    <a href="{% url 'users:admin_logout' %}" class="dropdown-item">Log Out</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->

    <!-- Delete Confirmation Start -->
    <div class="container-fluid pt-4 px-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
                <div class="bg-light rounded p-4">
                    <!-- Header -->
                    <div class="text-center mb-4">
                        <div class="bg-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-exclamation-triangle fa-2x text-white"></i>
                        </div>
                        <h2 class="text-danger mb-2">Delete Portfolio Project</h2>
                        <p class="text-muted">This action cannot be undone. Please confirm your decision.</p>
                    </div>

                    <!-- Project Information -->
                    <div class="card border-danger mb-4">
                        <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-briefcase me-2"></i>Project to be deleted
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    {% if project.images.first %}
                                        <img src="{{ project.images.first.image.url }}" 
                                             alt="{{ project.title }}" 
                                             class="img-fluid rounded"
                                             style="max-height: 150px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-secondary rounded d-flex align-items-center justify-content-center" 
                                             style="height: 150px;">
                                            <i class="fas fa-image fa-3x text-white"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-9">
                                    <h4 class="text-danger mb-3">{{ project.title }}</h4>
                                    
                                    <div class="row mb-3">
                                        <div class="col-sm-6">
                                            <strong>Client:</strong> {{ project.client_name|default:"Not specified" }}
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>Location:</strong> {{ project.location|default:"Not specified" }}
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-sm-6">
                                            <strong>Type:</strong> {{ project.get_project_type_display|default:"Not specified" }}
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>Status:</strong> {{ project.get_status_display }}
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-sm-6">
                                            <strong>Created:</strong> {{ project.created_at|date:"M d, Y" }}
                                        </div>
                                        <div class="col-sm-6">
                                            <strong>Views:</strong> {{ project.view_count }}
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <strong>Summary:</strong>
                                        <p class="text-muted mb-0">{{ project.summary|truncatechars:200|default:"No summary provided" }}</p>
                                    </div>
                                    
                                    <div class="d-flex gap-2">
                                        {% if project.is_published %}
                                            <span class="badge bg-success">Published</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Draft</span>
                                        {% endif %}
                                        
                                        {% if project.is_featured %}
                                            <span class="badge bg-warning">Featured</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Impact Warning -->
                    <div class="alert alert-warning" role="alert">
                        <h5 class="alert-heading">
                            <i class="fas fa-exclamation-triangle me-2"></i>What will be deleted:
                        </h5>
                        <ul class="mb-0">
                            <li><strong>Project information:</strong> All project details, descriptions, and metadata</li>
                            {% if images_count > 0 %}
                                <li><strong>{{ images_count }} project image{{ images_count|pluralize }}:</strong> All uploaded images will be permanently removed</li>
                            {% endif %}
                            {% if testimonials_count > 0 %}
                                <li><strong>{{ testimonials_count }} testimonial{{ testimonials_count|pluralize }}:</strong> Associated testimonials will be removed</li>
                            {% endif %}
                            <li><strong>View statistics:</strong> All view counts and engagement data</li>
                            <li><strong>SEO data:</strong> Meta titles, descriptions, and search engine optimization</li>
                        </ul>
                    </div>

                    <!-- Additional Warnings -->
                    {% if project.is_published %}
                    <div class="alert alert-danger" role="alert">
                        <h6 class="alert-heading">
                            <i class="fas fa-globe me-2"></i>Public Visibility Warning
                        </h6>
                        <p class="mb-0">This project is currently <strong>published</strong> and visible to the public. Deleting it will remove it from your portfolio page and may affect your website's SEO.</p>
                    </div>
                    {% endif %}

                    {% if project.is_featured %}
                    <div class="alert alert-warning" role="alert">
                        <h6 class="alert-heading">
                            <i class="fas fa-star me-2"></i>Featured Project Warning
                        </h6>
                        <p class="mb-0">This is a <strong>featured</strong> project that may be highlighted on your homepage. Consider unfeaturing it first or selecting another project to feature.</p>
                    </div>
                    {% endif %}

                    <!-- Confirmation Form -->
                    <div class="card border-danger">
                        <div class="card-body">
                            <h5 class="text-danger mb-3">Confirm Deletion</h5>
                            <p class="mb-4">Type <strong>"{{ project.title }}"</strong> to confirm deletion:</p>
                            
                            <form method="post" id="deleteForm">
                                {% csrf_token %}
                                <div class="mb-4">
                                    <input type="text" class="form-control" id="confirmInput" 
                                           placeholder="Type project title to confirm" required>
                                    <div class="form-text">This confirmation helps prevent accidental deletions.</div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <a href="{% url 'users:admin_portfolio_list' %}" class="btn btn-secondary btn-lg">
                                        <i class="fas fa-arrow-left me-2"></i>Cancel
                                    </a>
                                    <div>
                                        <a href="{% url 'users:admin_portfolio_detail' project.id %}" class="btn btn-info btn-lg me-3">
                                            <i class="fas fa-eye me-2"></i>View Details
                                        </a>
                                        <button type="submit" class="btn btn-danger btn-lg" id="deleteButton" disabled>
                                            <i class="fas fa-trash me-2"></i>Delete Project
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Alternative Actions -->
                    <div class="mt-4 text-center">
                        <p class="text-muted mb-3">Instead of deleting, you might want to:</p>
                        <div class="btn-group" role="group">
                            <a href="{% url 'users:admin_portfolio_edit' project.id %}" class="btn btn-outline-primary">
                                <i class="fas fa-edit me-2"></i>Edit Project
                            </a>
                            {% if project.is_published %}
                                <button class="btn btn-outline-warning" onclick="togglePublished()">
                                    <i class="fas fa-eye-slash me-2"></i>Unpublish
                                </button>
                            {% endif %}
                            {% if project.is_featured %}
                                <button class="btn btn-outline-secondary" onclick="toggleFeatured()">
                                    <i class="fas fa-star me-2"></i>Unfeature
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Delete Confirmation End -->
</div>
<!-- Content End -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmInput = document.getElementById('confirmInput');
    const deleteButton = document.getElementById('deleteButton');
    const projectTitle = "{{ project.title }}";
    
    confirmInput.addEventListener('input', function() {
        if (this.value === projectTitle) {
            deleteButton.disabled = false;
            deleteButton.classList.remove('btn-danger');
            deleteButton.classList.add('btn-danger');
        } else {
            deleteButton.disabled = true;
        }
    });
    
    // Prevent accidental form submission
    document.getElementById('deleteForm').addEventListener('submit', function(e) {
        if (confirmInput.value !== projectTitle) {
            e.preventDefault();
            alert('Please type the exact project title to confirm deletion.');
            return false;
        }
        
        if (!confirm('Are you absolutely sure you want to delete this project? This action cannot be undone.')) {
            e.preventDefault();
            return false;
        }
    });
});

function togglePublished() {
    fetch(`/users/admin/portfolio/{{ project.id }}/toggle-published/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}

function toggleFeatured() {
    fetch(`/users/admin/portfolio/{{ project.id }}/toggle-featured/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}
</script>
{% endblock %}
